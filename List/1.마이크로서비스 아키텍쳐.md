## **1. 트랜잭션(Transaction)이란?**

- 데이터베이스에서 하나의 논리적 작업 단위.
- **ACID 속성**:
    - **Atomicity:** 모든 작업이 성공적으로 수행되거나 아무것도 수행되지 않아야 함.
    - **Consistency:** 트랜잭션 완료 후 데이터베이스는 일관된 상태 유지.
    - **Isolation:** 동시 트랜잭션 실행시 서로 영향을 주지 않음.
    - **Durability:** 트랜잭션 완료 후의 결과는 영구적으로 반영.

## **2. 실무 예시:**

온라인 쇼핑몰에서의 상품 구매

1. 상품 재고 감소.
2. 사용자 잔액 차감.
3. 주문 내역 생성.
- 위 세 작업은 모두 성공하거나 모두 실패해야 함.

## **3. InnoDB와 트랜잭션:**

- MySQL의 스토리지 엔진 중 하나.
- 트랜잭션을 지원하며 ACID 속성을 만족.

## **4. InnoDB 적용 예시:**

```sql
START TRANSACTION;

UPDATE products SET stock = stock - 1 WHERE product_id = 1;
UPDATE users SET balance = balance - 10 WHERE user_id = 1;
INSERT INTO orders (user_id, product_id, order_date) VALUES (1, 1, NOW());

IF (문제 발생) THEN
    ROLLBACK;
ELSE
    COMMIT;
END IF;

```

## 5. 데이터 저장소 확장

일반적인 트랜잭션은 하나의 데이터베이스 인스턴스 내부에 사용할 수 있기에 데이터가 여러 인스턴스에 저장되면 트랜잭션 기능을 사용하기 어렵다.

### 예제

### **분산된 은행 시스템**

은행에는 두 개의 데이터베이스 서버(DB1, DB2)가 있다고 가정합니다. 한 서버(DB1)에는 사용자 A의 계좌 정보가, 다른 서버(DB2)에는 사용자 B의 계좌 정보가 저장되어 있습니다.

사용자 A가 사용자 B에게 $100을 송금하려고 합니다. 이를 위해서는:

1. DB1에서 사용자 A의 계좌에서 $100을 차감해야 합니다.
2. DB2에서 사용자 B의 계좌에 $100을 더해야 합니다.

이 두 작업은 한 트랜잭션으로 묶여야 합니다. 만약 중간에 문제가 발생하여 한 작업만 성공한다면, 돈은 소멸하거나 중복으로 생성될 수 있습니다.

**DB1 코드**

```sql
START TRANSACTION;

-- 사용자 A의 계좌에서 $100 차감
UPDATE accounts SET balance = balance - 100 WHERE user_id = 'A';

COMMIT;  -- 실제로는 이렇게 바로 커밋하지 않습니다!
```

**DB2 코드**

```sql
START TRANSACTION;

-- 사용자 B의 계좌에 $100 추가
UPDATE accounts SET balance = balance + 100 WHERE user_id = 'B';

COMMIT;  -- 실제로는 이렇게 바로 커밋하지 않습니다!
```

이렇게 각각의 데이터베이스에서 트랜잭션을 시작하면 문제가 생깁니다. DB1의 작업이 성공하더라도 DB2의 작업이 실패하면, 사용자 A는 $100을 잃고 사용자 B는 $100을 받지 못합니다.

즉, 일반적으로 우리가 생각하는 트랜잭션은 하나의 데이터베이스 내에서의 연산들을 안전하게 관리하는 것을 의미합니다. 그러나 현대의 대규모 시스템에서는 데이터가 여러 데이터베이스 인스턴스, 혹은 여러 서버에 분산되어 저장될 수 있습니다. 이런 환경에서는 전체 시스템에 걸쳐 일관된 트랜잭션을 유지하기가 어려운데, 이러한 문제를 해결하기 위한 방법으로 분산 트랜잭션(Distributed Transaction)과 같은 기술이 연구되고 사용되고 있습니다.
